box: golang

build:
  steps:
    - install-packages:
        packages: lirc

    - script:
      name: print version
      code: |
        go version
        lircd -v

    - script:
      name: launch lircd
      code: |
        export LIRC_RUN_PATH=$WERCKER_SOURCE_DIR/lirc/test
        cp $LIRC_RUN_PATH/lircd.conf /etc/lirc/
        lircd --pidfile=$LIRC_RUN_PATH/lirc.pid \
              --output=$LIRC_RUN_PATH/lircd \
              --allow-simulate \
              --driver default

    - setup-go-workspace:
      package-dir: github.com/ww24/lirc-web-api

    - glide-install

    - script:
      name: go test
      code: |
        go test -v $(glide nv)

    - script:
      name: go build
      code: |
        go build -o api

    - script:
      name: copy to output
      code: |
        pwd
        cp "$WERCKER_SOURCE_DIR/api" "$WERCKER_SOURCE_DIR/README.md" "$WERCKER_OUTPUT_DIR"

deploy:
  steps:
    - github-create-release:
      token: $GITHUB_TOKEN
      tag: v0.1.0
